# Hotel è¡Œæç®¡ç†ç³»ç»Ÿ API æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°
é…’åº—è¡Œæç®¡ç†ç³»ç»Ÿï¼Œæä¾›å‘˜å·¥è®¤è¯ã€æƒé™ç®¡ç†å’Œè¡Œæç®¡ç†åŠŸèƒ½

## åŸºç¡€ä¿¡æ¯
- **æœåŠ¡å™¨åœ°å€**: http://localhost:8080
- **è®¤è¯æ–¹å¼**: JWT åŒä»¤ç‰Œè®¤è¯ (Access Token + Refresh Token)
- **æƒé™ç³»ç»Ÿ**: RBAC (åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶)
- **é™æµç­–ç•¥**: ä»¤ç‰Œæ¡¶é™æµï¼Œæ¡¶å®¹é‡100ä¸ªä»¤ç‰Œï¼Œæ¯10msè¡¥å……1ä¸ªä»¤ç‰Œ
- **æ•°æ®åº“**: MySQL (studyæ•°æ®åº“)
- **Redis**: å¤šæ•°æ®åº“åˆ†ç¦»å­˜å‚¨ï¼ˆè®¿é—®ä»¤ç‰ŒDB0ã€åˆ·æ–°ä»¤ç‰ŒDB1ã€ç¼“å­˜DB2ã€é™æµDB3ï¼‰
- **å“åº”æ€§èƒ½**: ç™»å½•æ¥å£å¹³å‡å“åº”æ—¶é—´3-10ms

## ğŸ” è®¤è¯ç›¸å…³ API

### 1. å‘˜å·¥ç™»å½•
**POST** `/employee/login`

```json
è¯·æ±‚ä½“:
{
  "user": "zhangsan",        // ç”¨æˆ·å
  "password": "123456"        // å¯†ç 
}

æˆåŠŸå“åº”:
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 900,         // Access Token è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
    "token_type": "Bearer"
  }
}

å¤±è´¥å“åº”:
{
  "success": false,
  "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
}

æ³¨æ„:
- æ­¤æ¥å£ä¸éœ€è¦JWTè®¤è¯
- ç™»å½•æˆåŠŸåè¿”å›åŒä»¤ç‰Œ
- æ–°ç”¨æˆ·è‡ªåŠ¨åˆ†é…"å‘˜å·¥"è§’è‰²
```

### 2. åˆ·æ–°ä»¤ç‰Œ
**POST** `/employee/refresh`

```json
è¯·æ±‚ä½“:
{
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}

æˆåŠŸå“åº”:
{
  "success": true,
  "message": "tokenåˆ·æ–°æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 900,
    "token_type": "Bearer"
  }
}

å¤±è´¥å“åº”:
{
  "success": false,
  "message": "tokenæ— æ•ˆ"
}
```

### 3. å‘˜å·¥é€€å‡º
**POST** `/employee/logout`

```json
è¯·æ±‚å¤´:
Authorization: Bearer <access_token>

å“åº”:
{
  "success": true,
  "message": "é€€å‡ºæˆåŠŸ"
}

å¤±è´¥å“åº”:
{
  "success": false,
  "message": "tokenæ— æ•ˆ"
}
```

## ğŸ”§ æƒé™ç®¡ç† API

**æ³¨æ„**: ä»¥ä¸‹æ‰€æœ‰æ¥å£éƒ½éœ€è¦JWTè®¤è¯ + "ç®¡ç†å‘˜"æƒé™

### 4. æ·»åŠ æƒé™
**POST** `/tool/add/permission`

```json
è¯·æ±‚ä½“:
{
  "name": "æŸ¥çœ‹è¡Œæ"          // æƒé™åç§°
}

å“åº”:
{
  "success": true,
  "message": "æƒé™æ·»åŠ æˆåŠŸ",
  "data": {
    "id": 1,
    "name": "æŸ¥çœ‹è¡Œæ"
  }
}
```

### 5. æ·»åŠ è§’è‰²
**POST** `/tool/add/role`

```json
è¯·æ±‚ä½“:
{
  "name": "è¡Œæç®¡ç†å‘˜"        // è§’è‰²åç§°
}

å“åº”:
{
  "success": true,
  "message": "æ·»åŠ æˆåŠŸ",
  "data": {
    "id": 1,
    "name": "è¡Œæç®¡ç†å‘˜"
  }
}
```

### 6. æ·»åŠ è§’è‰²æƒé™å…³è”
**POST** `/tool/add/role_permission`

```json
è¯·æ±‚ä½“:
{
  "role_id": 1,              // è§’è‰²ID
  "permission_id": 1         // æƒé™ID
}

å“åº”:
{
  "success": true,
  "message": "å…³è”æˆåŠŸ"
}
```

### 7. æ›´æ”¹å‘˜å·¥è§’è‰²
**POST** `/tool/change/employee_role`

```json
è¯·æ±‚ä½“:
{
  "employee_id": 1,           // å‘˜å·¥ID
  "role_id": 2                // æ–°è§’è‰²ID
}

å“åº”:
{
  "success": true,
  "message": "è§’è‰²ä¿®æ”¹æˆåŠŸ"
}
```

### 8. å‘˜å·¥æ³¨å†Œï¼ˆç®¡ç†å‘˜æ“ä½œï¼‰
**POST** `/tool/add/employee`

```json
è¯·æ±‚ä½“:
{
  "name": "å¼ ä¸‰",            // å‘˜å·¥å§“å
  "user": "zhangsan",         // ç”¨æˆ·å
  "password": "123456"       // å¯†ç 
}

å“åº”:
{
  "success": true,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "id": 1,
    "name": "å¼ ä¸‰",
    "user": "zhangsan",
    "role_id": 1,
    "role": {
      "id": 1,
      "name": "å‘˜å·¥"
    }
  }
}
```

### 9. è·å–æ‰€æœ‰å‘˜å·¥
**GET** `/tool/get/employee`

```json
å“åº”:
{
  "success": true,
  "message": "è·å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "name": "å¼ ä¸‰",
      "user": "zhangsan",
      "role_id": 1,
      "role": {
        "id": 1,
        "name": "å‘˜å·¥"
      }
    }
  ]
}
```

### 10. è·å–æ‰€æœ‰æƒé™
**GET** `/tool/get/permission`

```json
å“åº”:
{
  "success": true,
  "message": "è·å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "name": "åˆ›å»ºè¡Œæ"
    },
    {
      "id": 2,
      "name": "æŸ¥çœ‹è¡Œæ"
    },
    {
      "id": 3,
      "name": "æ›´æ–°è¡Œæ"
    },
    {
      "id": 4,
      "name": "åˆ é™¤è¡Œæ"
    }
  ]
}
```

### 11. è·å–æ‰€æœ‰è§’è‰²
**GET** `/tool/get/role`

```json
å“åº”:
{
  "success": true,
  "message": "è·å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "name": "å‘˜å·¥",
      "permissions": [
        {
          "id": 1,
          "name": "åˆ›å»ºè¡Œæ"
        },
        {
          "id": 2,
          "name": "æŸ¥çœ‹è¡Œæ"
        }
      ]
    }
  ]
}
```

### 12. åˆ é™¤å‘˜å·¥
**POST** `/tool/delete/employee`

```json
è¯·æ±‚ä½“:
{
  "employee_id": 1            // å‘˜å·¥ID
}

å“åº”:
{
  "success": true,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

### 13. åˆ é™¤è§’è‰²
**POST** `/tool/delete/role`

```json
è¯·æ±‚ä½“:
{
  "role_id": 1                // è§’è‰²ID
}

å“åº”:
{
  "success": true,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

### 14. åˆ é™¤æƒé™
**POST** `/tool/delete/permission`

```json
è¯·æ±‚ä½“:
{
  "permission_id": 1            // æƒé™ID
}

å“åº”:
{
  "success": true,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

## ğŸ§³ è¡Œæç®¡ç† API

**æ³¨æ„**: ä»¥ä¸‹æ‰€æœ‰æ¥å£éƒ½éœ€è¦JWTè®¤è¯å’Œç›¸åº”æƒé™

### 15. æ·»åŠ è¡Œæ
**POST** `/employee/add/luggage`  
**éœ€è¦æƒé™**: "åˆ›å»ºè¡Œæ"

```json
è¯·æ±‚ä½“:
{
  "guest_name": "å¼ ä¸‰",      // å®¢æˆ·å§“åï¼ˆç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºå®¢æˆ·è®°å½•ï¼‰
  "tag": "çº¢è‰²è¡Œæç®±",        // å¿…å¡«ï¼šè¡Œææ ‡ç­¾
  "weight": 15.5,           // å¯é€‰ï¼šè¡Œæé‡é‡
  "status": "å¯„å­˜ä¸­",        // å¯é€‰ï¼Œé»˜è®¤"å¯„å­˜ä¸­"
  "location": "å‰å°"         // å¯é€‰ï¼Œé»˜è®¤"å‰å°"
}

æˆåŠŸå“åº”:
{
  "success": true,
  "message": "è¡Œææ·»åŠ æˆåŠŸ",
  "data": {
    "id": 1,
    "guest_id": 1,
    "guest_name": "å¼ ä¸‰",
    "tag": "çº¢è‰²è¡Œæç®±",
    "weight": 15.5,
    "status": "å¯„å­˜ä¸­",
    "location": "å‰å°"
  }
}

æƒé™ä¸è¶³å“åº”:
{
  "success": false,
  "message": "æ²¡æœ‰æƒé™"
}
```

### 16. åˆ é™¤è¡Œæ
**POST** `/employee/delete/luggage`  
**éœ€è¦æƒé™**: "åˆ é™¤è¡Œæ"

```json
è¯·æ±‚ä½“:
{
  "id": 1                    // å¿…å¡«ï¼šè¡ŒæID
}

æˆåŠŸå“åº”:
{
  "success": true,
  "message": "è¡Œæåˆ é™¤æˆåŠŸ"
}

å¤±è´¥å“åº”:
{
  "success": false,
  "message": "è¡Œæè®°å½•ä¸å­˜åœ¨"
}
```

### 17. æ›´æ–°è¡Œæ
**POST** `/employee/update/luggage`  
**éœ€è¦æƒé™**: "æ›´æ–°è¡Œæ"

```json
è¯·æ±‚ä½“:
{
  "id": 1,                    // å¿…å¡«ï¼šè¡ŒæID
  "status": "å·²å–å‡º",         // å¯é€‰ï¼šè¡ŒæçŠ¶æ€
  "location": "å·²å–å‡º",       // å¯é€‰ï¼šè¡Œæä½ç½®
  "tag": "æ–°æ ‡ç­¾",            // å¯é€‰ï¼šè¡Œææ ‡ç­¾
  "weight": 12.5              // å¯é€‰ï¼šè¡Œæé‡é‡
}

æˆåŠŸå“åº”:
{
  "success": true,
  "message": "è¡Œææ›´æ–°æˆåŠŸ",
  "data": {
    "id": 1,
    "guest_id": 1,
    "guest_name": "å¼ ä¸‰",
    "tag": "æ–°æ ‡ç­¾",
    "weight": 12.5,
    "status": "å·²å–å‡º",
    "location": "å·²å–å‡º"
  }
}
```

## ğŸ” è¡ŒææŸ¥è¯¢ API

### 18. æŒ‰å®¢æˆ·å§“åæŸ¥è¯¢
**GET** `/employee/get/name?guest_name=å¼ ä¸‰`  
**éœ€è¦æƒé™**: "æŸ¥çœ‹è¡Œæ"

```json
å“åº”:
{
  "success": true,
  "message": "è¡Œæè·å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "guest_id": 1,
      "guest_name": "å¼ ä¸‰",
      "tag": "çº¢è‰²è¡Œæç®±",
      "weight": 15.5,
      "status": "å¯„å­˜ä¸­",
      "location": "å‰å°"
    }
  ],
  "count": 1
}
```

### 19. æŸ¥è¯¢æ‰€æœ‰è¡Œæ
**GET** `/employee/get/all`  
**éœ€è¦æƒé™**: "æŸ¥çœ‹è¡Œæ"

```json
å“åº”:
{
  "success": true,
  "message": "è¡Œæè·å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "guest_id": 1,
      "guest_name": "å¼ ä¸‰",
      "tag": "çº¢è‰²è¡Œæç®±",
      "weight": 15.5,
      "status": "å¯„å­˜ä¸­",
      "location": "å‰å°"
    }
  ],
  "count": 1
}
```

### 20. æŒ‰å®¢æˆ·IDæŸ¥è¯¢
**GET** `/employee/get/guest_id?guest_id=1`  
**éœ€è¦æƒé™**: "æŸ¥çœ‹è¡Œæ"

```json
å“åº”:
{
  "success": true,
  "message": "è¡Œæè·å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "guest_id": 1,
      "guest_name": "å¼ ä¸‰",
      "tag": "çº¢è‰²è¡Œæç®±",
      "weight": 15.5,
      "status": "å¯„å­˜ä¸­",
      "location": "å‰å°"
    }
  ],
  "count": 1
}
```

### 21. æŒ‰å­˜æ”¾ä½ç½®æŸ¥è¯¢
**GET** `/employee/get/location?location=å‰å°`  
**éœ€è¦æƒé™**: "æŸ¥çœ‹è¡Œæ"

```json
å“åº”:
{
  "success": true,
  "message": "è¡Œæè·å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "guest_id": 1,
      "guest_name": "å¼ ä¸‰",
      "tag": "çº¢è‰²è¡Œæç®±",
      "weight": 15.5,
      "status": "å¯„å­˜ä¸­",
      "location": "å‰å°"
    }
  ],
  "count": 1
}
```

### 22. æŒ‰çŠ¶æ€æŸ¥è¯¢
**GET** `/employee/get/status?status=å¯„å­˜ä¸­`  
**éœ€è¦æƒé™**: "æŸ¥çœ‹è¡Œæ"

```json
å“åº”:
{
  "success": true,
  "message": "è¡Œæè·å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "guest_id": 1,
      "guest_name": "å¼ ä¸‰",
      "tag": "çº¢è‰²è¡Œæç®±",
      "weight": 15.5,
      "status": "å¯„å­˜ä¸­",
      "location": "å‰å°"
    }
  ],
  "count": 1
}
```

### 23. é«˜çº§æŸ¥è¯¢ï¼ˆå¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢ï¼‰
**POST** `/employee/get/guest_advance`  
**éœ€è¦æƒé™**: "æŸ¥çœ‹è¡Œæ"

```json
è¯·æ±‚ä½“:
{
  "guest_name": "å¼ ä¸‰",      // å¯é€‰ï¼šå®¢æˆ·å§“å
  "guest_id": 1,             // å¯é€‰ï¼šå®¢æˆ·ID
  "tag": "çº¢è‰²è¡Œæç®±",        // å¯é€‰ï¼šè¡Œææ ‡ç­¾
  "weight": 15.5,            // å¯é€‰ï¼šè¡Œæé‡é‡
  "location": "å‰å°",         // å¯é€‰ï¼šå­˜æ”¾ä½ç½®
  "status": "å¯„å­˜ä¸­"          // å¯é€‰ï¼šè¡ŒæçŠ¶æ€ï¼Œé»˜è®¤ä¸º"å¯„å­˜ä¸­"
}

å“åº”:
{
  "success": true,
  "message": "è·å–è¡ŒææˆåŠŸ",
  "data": [
    {
      "id": 1,
      "guest_id": 1,
      "guest_name": "å¼ ä¸‰",
      "tag": "çº¢è‰²è¡Œæç®±",
      "weight": 15.5,
      "status": "å¯„å­˜ä¸­",
      "location": "å‰å°"
    }
  ],
  "count": 1
}
```

## ğŸ“Š ç»Ÿè®¡åŠŸèƒ½ API

**æ³¨æ„**: ç»Ÿè®¡åŠŸèƒ½åªéœ€è¦JWTè®¤è¯ï¼Œæ— éœ€ç‰¹å®šæƒé™

### 24. è·å–æ€»è¡Œææ•°é‡
**GET** `/employee/count/sum`

```json
å“åº”:
{
  "success": true,
  "message": "è¡Œææ•°é‡è·å–æˆåŠŸ",
  "count": 25
}
```

### 25. è·å–ä»Šæ—¥è¡Œæç»Ÿè®¡
**GET** `/employee/count/today`

```json
å“åº”:
{
  "success": true,
  "message": "è·å–ä»Šæ—¥ç»Ÿè®¡æˆåŠŸ",
  "data": {
    "date": "2025-12-11",
    "today_added": 8,    // ä»Šæ—¥æ–°å¢è¡Œææ•°é‡
    "today_taken": 3      // ä»Šæ—¥å–å‡ºè¡Œææ•°é‡
  }
}
```

## ğŸ“Š æ•°æ®æ¨¡å‹

### Employee (å‘˜å·¥è¡¨)
```go
type Employee struct {
    ID       uint   `gorm:"primaryKey;autoIncrement;type:int unsigned"`
    Name     string `json:"name" gorm:"column:name"`
    User     string `json:"user" gorm:"column:user"`
    Password string `json:"password" gorm:"column:password"`
    RoleID   uint   `json:"role_id" gorm:"column:role_id"`
    Role     Role   `gorm:"foreignKey:RoleID"`
}
```

### Role (è§’è‰²è¡¨)
```go
type Role struct {
    ID          uint        `gorm:"primaryKey;autoIncrement"`
    Name        string      `json:"name" gorm:"column:name"`
    Permissions []Permission `gorm:"many2many:role_permission"`
}
```

### Permission (æƒé™è¡¨)
```go
type Permission struct {
    ID   uint   `gorm:"primaryKey;autoIncrement"`
    Name string `json:"name" gorm:"column:name"`
}
```

### Luggage (è¡Œæè¡¨)
```go
type Luggage struct {
    ID        uint           `gorm:"primaryKey;autoIncrement"`
    GuestID   uint           `json:"guest_id" gorm:"column:guest_id"`
    Tag       string         `json:"tag" gorm:"column:tag;size:50"`
    Weight    float32        `json:"weight" gorm:"column:weight"`
    Status    string         `json:"status" gorm:"column:status;size:20"`
    Location  string         `json:"location" gorm:"column:location;size:100"`
    CreatedAt time.Time      `json:"-"`
    UpdatedAt time.Time      `json:"-"`
    DeletedAt gorm.DeletedAt `gorm:"index" json:"-"`
    Guest    Guest          `gorm:"foreignKey:GuestID"`
}
```

### Guest (å®¢æˆ·è¡¨)
```go
type Guest struct {
    ID   uint   `gorm:"primaryKey;autoIncrement;type:int unsigned"`
    Name string `json:"name" gorm:"column:guest_name"`
}
```

## ğŸ”’ æƒé™ç³»ç»Ÿè®¾è®¡

### RBACæƒé™æ¨¡å‹
1. **ç”¨æˆ·(User)** â†’ **è§’è‰²(Role)**: ä¸€å¯¹å¤šå…³ç³»
2. **è§’è‰²(Role)** â†’ **æƒé™(Permission)**: å¤šå¯¹å¤šå…³ç³»

### é»˜è®¤è§’è‰²å’Œæƒé™
- **å‘˜å·¥**: åˆ›å»ºè¡Œæã€æŸ¥çœ‹è¡Œæã€æ›´æ–°è¡Œæã€åˆ é™¤è¡Œæ
- **ç®¡ç†å‘˜**: ç®¡ç†å‘˜æƒé™ï¼ˆåŒ…å«æ‰€æœ‰å‘˜å·¥æƒé™ + ç”¨æˆ·ç®¡ç†æƒé™ï¼‰

### æƒé™æ£€æŸ¥æµç¨‹
1. JwtCheck() éªŒè¯JWTä»¤ç‰Œ
2. AuthCheck() åŠ è½½ç”¨æˆ·æƒé™åˆ°ä¸Šä¸‹æ–‡  
3. CheckAction() æ£€æŸ¥ç‰¹å®šæƒé™
4. æƒé™é€šè¿‡åˆ™æ‰§è¡Œä¸šåŠ¡é€»è¾‘

### æƒé™æ£€æŸ¥æµç¨‹
1. JwtCheck() éªŒè¯JWTä»¤ç‰Œ
2. AuthCheck() åŠ è½½ç”¨æˆ·æƒé™åˆ°ä¸Šä¸‹æ–‡
3. CheckAction() æ£€æŸ¥ç‰¹å®šæƒé™
4. æƒé™é€šè¿‡åˆ™æ‰§è¡Œä¸šåŠ¡é€»è¾‘

## âš¡ é™æµé…ç½®

- **ä»¤ç‰Œæ¡¶å®¹é‡**: 100ä¸ªä»¤ç‰Œ
- **è¡¥å……é€Ÿç‡**: æ¯10msè¡¥å……1ä¸ªä»¤ç‰Œ
- **æ¯ä¸ªè¯·æ±‚**: æ¶ˆè€—1ä¸ªä»¤ç‰Œ
- **è¶…å‡ºé™åˆ¶**: è¿”å›429çŠ¶æ€ç 
- **é”æœºåˆ¶**: Redisåˆ†å¸ƒå¼é”ï¼Œé”è¶…æ—¶100ms

## ğŸ“ˆ çŠ¶æ€ç è¯´æ˜

- `200`: æ“ä½œæˆåŠŸ
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `401`: æœªè®¤è¯æˆ–ä»¤ç‰Œæ— æ•ˆ/è¿‡æœŸ
- `403`: æƒé™ä¸è¶³
- `404`: èµ„æºæœªæ‰¾åˆ°
- `429`: è¯·æ±‚è¿‡äºé¢‘ç¹
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

## ğŸš€ å¯åŠ¨æ–¹å¼

```bash
cd c:/Users/å‚…ä»æ°/Desktop/hotel
go run api/main.go
```

æœåŠ¡å™¨å°†åœ¨ `http://0.0.0.0:8080` å¯åŠ¨

### ç³»ç»Ÿæ—¥å¿—ç¤ºä¾‹
```
2025/12/11 17:10:52 local é™æµå™¨ 9
[GIN] 2025/12/11 - 17:10:52 | 200 |      7.3677ms |             ::1 | POST     "/employee/login"
```
---
æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2025-12-11  
é¡¹ç›®ç‰ˆæœ¬: 2.8.0